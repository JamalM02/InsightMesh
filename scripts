# Update system and install curl
sudo apt update && sudo apt install -y curl

# Install Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Install npm packages globally (with sudo to avoid permission errors)
sudo npm install -g pm2 dotenv-cli

# OPTIONAL: Fix npm permissions permanently (recommended by npm)
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=$HOME/.npm-global/bin:$PATH' >> ~/.profile
source ~/.profile

sudo npm install -g next
# Check installations
node -v
npm -v
pm2 -v
dotenv -v

# Install Docker (if not already installed)
sudo apt install -y docker.io docker-compose
sudo systemctl enable docker
sudo usermod -aG docker $USER
newgrp docker

open ports
kafka 9092
clickhouse 8123
grpc-account 50053
grpc-events 50052

mkdir -p packages/grpc-account/src/grpc
mkdir -p packages/grpc-events/src/grpc

nano packages/grpc-account/.env
nano packages/grpc-events/.env
nano apps/front/.env

npm install --workspace=packages/docs --legacy-peer-deps
npm install --workspace=packages/node-common
npm install --workspace=packages/grpc-account
npm install --workspace=packages/grpc-events


--- same for grpc-events
cd packages/grpc-account
npx prisma generate
cd packages/grpc-events
npx prisma generate

-- first time db
npm run prisma:push --workspace=packages/grpc-account



npm run build --workspace @insightmesh/node-common
npm run build --workspace @insightmesh/grpc-account
npm run build --workspace @insightmesh/grpc-events
npm run build --workspace @insightmesh/front



------------------docker up -------------------


dotenv -e .env -- pm2 start npm --name "grpc-account" -- run start
dotenv -e .env -- pm2 start npm --name "grpc-events" -- run start


//in root pm2
pm2 start npm --name "grpc-account" --workspace "@insightmesh/grpc-account" -- run start

//inside grpc file pm2
cd packages/grpc-account
pm2 start npm --name "grpc-account" -- run start
cd InsightMesh
cd packages/grpc-account
pm2 start npm --name "grpc-events" -- run start
cd apps/front
pm2 start "npx next start -p 5000 -H 0.0.0.0" --name front
pm2 start npm --name "api-gateway" -- run start

//log to pm2
pm2 list
pm2 logs grpc-account
pm2 stop grpc-account
pm2 delete grpc-account


//clickhouse
after running on docker
docker exec -it clickhouse clickhouse-client
run the scripts in clickhouse.sql

// Start the API Gateway service
 npm run dev --workspace=apps/api-gateway

// Start the gRPC Account service

//for new db
 npm run prisma:push --workspace=packages/grpc-account
 //create client prisma


 npm run prisma:generate --workspace=packages/grpc-account


 npm run dev:windows --workspace=packages/grpc-account


// Start the gRPC event service
 npm run dev:windows --workspace=packages/grpc-events


git clone git@github.com:jamalm02/InsightMesh.git InsightMesh



sudo nano /etc/nginx/sites-available/insightmesh
sudo nginx -t
sudo systemctl reload nginx
